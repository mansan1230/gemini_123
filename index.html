<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>God Mode Trader Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d1117; --card-bg: #161b22; --border-color: #30363d;
            --text-main: #c9d1d9; --text-muted: #8b949e; --accent: #58a6ff;
            --up: #3fb950; --down: #f85149; --flat: #8b949e;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: var(--text-main); margin: 0; padding: 20px; }
        a { text-decoration: none; color: inherit; }

        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); margin-bottom: 20px; }
        .header h1 { margin: 0; font-size: 1.5rem; color: var(--accent); }
        .header-actions { display: flex; gap: 15px; align-items: center; }
        
        .fng-card { background: rgba(33,38,45,0.5); border: 1px solid var(--border-color); padding: 5px 15px; border-radius: 6px; text-align: center; }
        .fng-val { font-weight: 800; font-size: 1.1rem; }
        .fng-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; }

        .btn-refresh { background: #238636; color: white; border: 1px solid rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; }
        .btn-refresh:disabled { background: #333; }

        /* Grid */
        .main-container { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; max-width: 1800px; margin: 0 auto; }
        
        .box { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 10px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .box-header { padding: 10px 15px; background: #21262d; border-bottom: 1px solid var(--border-color); font-weight: 600; font-size: 0.9rem; }

        /* Table */
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { text-align: left; padding: 8px 12px; color: var(--text-muted); font-weight: 500; font-size: 0.75rem; background: #1c2128; }
        td { padding: 8px 12px; border-bottom: 1px solid rgba(48,54,61,0.5); }
        .price { font-family: 'Inter', monospace; font-weight: 600; }
        .up { color: var(--up); } .down { color: var(--down); }

        /* Trend Tag */
        .trend-tag { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 700; }
        .bull { background: rgba(63,185,80,0.15); color: var(--up); }
        .bear { background: rgba(248,81,73,0.15); color: var(--down); }
        .flat { background: rgba(139,148,158,0.15); color: var(--flat); }

        /* RSI Bar */
        .rsi-track { width: 35px; height: 4px; background: #30363d; border-radius: 2px; display: inline-block; margin-right: 5px; }
        .rsi-fill { height: 100%; border-radius: 2px; }
        .rsi-val { font-family: monospace; font-weight: 700; font-size: 0.8rem; }

        /* News */
        .news-box { height: 450px; overflow-y: auto; }
        .news-item { padding: 10px 15px; border-bottom: 1px solid var(--border-color); }
        .news-item:hover { background: rgba(88,166,255,0.05); }
        .news-meta { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px; display: flex; justify-content: space-between; }
        .news-source { color: var(--accent); font-weight: 700; }
        .news-title a { color: #e6edf3; font-weight: 500; line-height: 1.4; display: block; }

        .calendar-container { height: 400px; }
        
        @media (max-width: 1200px) { .main-container { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 768px) { .main-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1>ğŸš€ God Mode Terminal</h1>
            <div id="update-time" class="timestamp">Initializing...</div>
        </div>
        <div class="header-actions">
            <span id="status-msg" style="font-size:0.8rem; color:#888;"></span>
            <div class="fng-card">
                <div class="fng-label">Crypto Sentiment</div>
                <div class="fng-value" id="fng-val">--</div>
            </div>
            <button id="refresh-btn" class="btn-refresh" onclick="triggerUpdate()">ğŸ”„ Update</button>
        </div>
    </div>

    <div class="main-container">
        
        <div>
            <div class="box">
                <div class="box-header">ğŸŒ ä¸»è¦æŒ‡æ•¸ (Indices)</div>
                <table><thead><tr><th>Asset</th><th>Price</th><th>Trend</th><th>RSI</th></tr></thead><tbody id="indices-box"></tbody></table>
            </div>
            <div class="box">
                <div class="box-header">ğŸª™ åŠ å¯†è²¨å¹£ (Crypto)</div>
                <table><thead><tr><th>Asset</th><th>Price</th><th>Trend</th><th>RSI</th></tr></thead><tbody id="crypto-box"></tbody></table>
            </div>
        </div>

        <div>
            <div class="box">
                <div class="box-header">ğŸš¢ èˆªé‹é‹åƒ¹ (Freight / Shipping)</div>
                <table><thead><tr><th>Index/ETF</th><th>Price</th><th>Trend</th><th>RSI</th></tr></thead><tbody id="shipping-box"></tbody></table>
            </div>
            <div class="box">
                <div class="box-header">ğŸ”® ç¾è‚¡æœŸè²¨ (Futures)</div>
                <table><thead><tr><th>Asset</th><th>Price</th><th>Trend</th><th>RSI</th></tr></thead><tbody id="futures-box"></tbody></table>
            </div>
            <div class="box">
                <div class="box-header">ğŸŒŠ å®è§€ & å¤–åŒ¯ (Macro/FX)</div>
                <table><thead><tr><th>Indicator</th><th>Value</th><th>Trend</th><th>State</th></tr></thead><tbody id="macro-box"></tbody></table>
            </div>
            <div class="box">
                <div class="box-header">ğŸ­ æ¿å¡Š & å•†å“ (Sectors/Comm)</div>
                <table><thead><tr><th>Asset</th><th>Price</th><th>Trend</th><th>RSI</th></tr></thead><tbody id="mixed-box"></tbody></table>
            </div>
        </div>

        <div>
            <div class="box">
                <div class="box-header">âš¡ å¸‚å ´å¿«è¨Š (Live News)</div>
                <div id="news-box" class="news-box"></div>
            </div>
            <div class="box calendar-container">
                <div class="box-header">ğŸ“… è²¡ç¶“æ—¥æ›† (Calendar)</div>
                <div class="tradingview-widget-container">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
                    { "width": "100%", "height": "360", "colorTheme": "dark", "isTransparent": true, "locale": "en", "importanceFilter": "0,1", "currencyFilter": "USD" }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <script>
        function triggerUpdate() {
            const btn = document.getElementById('refresh-btn');
            const msg = document.getElementById('status-msg');
            btn.disabled = true; btn.innerHTML = "â³ Sending...";
            // è¨˜å¾—å¡«å…¥ä½ çš„ Worker ç¶²å€
            fetch('https://dashboard.mansantamm.workers.dev', { method: 'POST' })
                .then(r => {
                    if (r.ok) { btn.innerHTML = "âœ… Sent"; msg.innerText = "Wait ~1m & Refresh"; }
                    else throw new Error();
                })
                .catch(() => { btn.innerHTML = "âŒ Error"; btn.style.background = "#f85149"; });
        }

        fetch('daily_news.json?t=' + new Date().getTime())
            .then(r => r.json())
            .then(d => {
                document.getElementById('update-time').textContent = "DATA TIME: " + d.update_time;
                
                if(d.crypto_fng) {
                    const el = document.getElementById('fng-val');
                    const val = d.crypto_fng.value;
                    el.textContent = val;
                    el.style.color = val < 30 ? 'var(--down)' : (val > 70 ? 'var(--up)' : 'white');
                }

                function renderTable(id, list) {
                    const el = document.getElementById(id);
                    if(!list || !el) return;
                    list.forEach(i => {
                        const colorClass = i.change >= 0 ? 'up' : 'down';
                        const sign = i.change >= 0 ? '+' : '';
                        
                        let trendClass = 'flat';
                        if(i.trend.includes("å¤šé ­")) trendClass = 'bull';
                        if(i.trend.includes("ç©ºé ­")) trendClass = 'bear';
                        const trendHtml = `<span class="trend-tag ${trendClass}">${i.trend.replace('ğŸ“ˆ ','').replace('ğŸ“‰ ','')}</span>`;

                        let rsiHtml = '<td style="text-align:right; color:#555">-</td>';
                        if(i.rsi && i.rsi !== "-") {
                            let barC = '#30363d'; let valC = '#888';
                            if(i.rsi > 70) { barC = 'var(--down)'; valC = 'var(--down)'; }
                            if(i.rsi < 30) { barC = 'var(--up)'; valC = 'var(--up)'; }
                            rsiHtml = `<td style="text-align:right"><div style="display:inline-flex; align-items:center"><div class="rsi-track"><div class="rsi-fill" style="width:${i.rsi}%; background:${barC}"></div></div><span class="rsi-val" style="color:${valC}">${Math.round(i.rsi)}</span></div></td>`;
                        }

                        el.innerHTML += `
                            <tr>
                                <td><span style="font-weight:500; color:#fff">${i.name.split(' ')[1]||i.name}</span></td>
                                <td><div class="price">${i.price.toLocaleString()}</div><div style="font-size:0.75rem" class="${colorClass}">${sign}${i.percent}%</div></td>
                                <td>${trendHtml}</td>
                                ${rsiHtml}
                            </tr>`;
                    });
                }

                if(d.data) {
                    renderTable('indices-box', d.data.indices);
                    renderTable('crypto-box', d.data.crypto);
                    renderTable('shipping-box', d.data.shipping); // ğŸ”¥ æ–°å¢ï¼šèˆªé‹
                    renderTable('futures-box', d.data.futures);
                    renderTable('macro-box', d.data.macro);
                    // åˆä½µ Sectors å’Œ Commodities é¡¯ç¤º
                    const mixed = [...(d.data.commodities||[]), ...(d.data.sectors||[])];
                    renderTable('mixed-box', mixed);
                }

                const newsEl = document.getElementById('news-box');
                if(d.news) {
                    d.news.forEach(n => {
                        newsEl.innerHTML += `
                            <div class="news-item">
                                <div class="news-meta"><span class="news-source">${n.source}</span><span>${n.time}</span></div>
                                <div class="news-title"><a href="${n.link}" target="_blank">${n.title}</a></div>
                            </div>`;
                    });
                }
            });
    </script>
</body>
</html>
