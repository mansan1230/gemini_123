<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>God Mode Trader Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* === 1. å…¨å±€è®Šæ•¸ (Modern Dark Theme) === */
        :root {
            --bg-color: #0d1117;        /* æ·±ç°èƒŒæ™¯ */
            --card-bg: #161b22;         /* å¡ç‰‡èƒŒæ™¯ */
            --border-color: #30363d;    /* é‚Šæ¡†è‰² */
            --header-bg: #21262d;       /* æ¨™é¡Œæ¬„èƒŒæ™¯ */
            
            --text-main: #c9d1d9;       /* ä¸»è¦æ–‡å­— */
            --text-muted: #8b949e;      /* æ¬¡è¦æ–‡å­— */
            
            --accent: #58a6ff;          /* è—è‰²å¼·èª¿ */
            --up: #3fb950;              /* æ¼² (ç¶ ) */
            --down: #f85149;            /* è·Œ (ç´…) */
            --flat: #8b949e;            /* å¹³ (ç°) */
        }

        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color); 
            color: var(--text-main); 
            margin: 0; 
            padding: 20px; 
            line-height: 1.5;
        }

        a { text-decoration: none; color: inherit; transition: color 0.2s; }
        a:hover { color: var(--accent); }

        /* === 2. é ‚éƒ¨ Header === */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid var(--border-color);
            margin-bottom: 25px;
        }
        
        .header-title h1 { 
            margin: 0; font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px;
            background: linear-gradient(90deg, #58a6ff, #a371f7); /* æ¼¸å±¤æ¨™é¡Œ */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .timestamp { color: var(--text-muted); font-family: monospace; font-size: 0.85rem; margin-top: 2px; }

        .header-actions { display: flex; align-items: center; gap: 15px; }

        /* ææ…ŒæŒ‡æ•¸å¡ç‰‡ */
        .fng-card {
            background: rgba(33, 38, 45, 0.5);
            border: 1px solid var(--border-color);
            padding: 6px 15px;
            border-radius: 8px;
            text-align: center;
            min-width: 80px;
        }
        .fng-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .fng-value { font-size: 1.1rem; font-weight: 800; }

        /* æ›´æ–°æŒ‰éˆ• */
        .btn-refresh {
            background-color: #238636; 
            color: white;
            border: 1px solid rgba(240,246,252,0.1);
            padding: 8px 16px; 
            border-radius: 6px;
            font-weight: 600; font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
        }
        .btn-refresh:hover { background-color: #2ea043; transform: translateY(-1px); }
        .btn-refresh:active { transform: translateY(0); }
        .btn-refresh:disabled { background-color: #333; color: #888; cursor: not-allowed; }

        /* ç‹€æ…‹è¨Šæ¯ */
        #status-msg { font-size: 0.8rem; color: var(--text-muted); margin-left: 10px; }

        /* === 3. Grid ä½ˆå±€ === */
        .main-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* æ¨™æº–ä¸‰æ¬„ */
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* å¡ç‰‡å®¹å™¨ */
        .box {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px; /* åœ“è§’åŠ å¤§ */
            overflow: hidden;
            display: flex; flex-direction: column;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); /* å¢åŠ ç«‹é«”æ„Ÿ */
        }
        
        .box-header {
            padding: 12px 16px; 
            background: var(--header-bg);
            border-bottom: 1px solid var(--border-color);
            font-weight: 600; font-size: 0.9rem;
            color: var(--text-main);
            letter-spacing: 0.5px;
            display: flex; align-items: center; justify-content: space-between;
        }

        /* è¡¨æ ¼å„ªåŒ– */
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        
        th { 
            text-align: left; padding: 10px 16px; 
            color: var(--text-muted); font-weight: 500; font-size: 0.75rem; 
            text-transform: uppercase; letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-color);
        }
        
        td { 
            padding: 10px 16px; 
            border-bottom: 1px solid rgba(48, 54, 61, 0.5); 
            vertical-align: middle;
        }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: rgba(255,255,255,0.02); } /* æ»‘éè®Šè‰² */

        .asset-name { font-weight: 500; color: #fff; display: block; }
        .price { font-family: 'Inter', monospace; font-weight: 600; letter-spacing: -0.5px; }
        
        .up { color: var(--up); }
        .down { color: var(--down); }
        .flat { color: var(--flat); }

        /* è¶¨å‹¢æ¨™ç±¤ */
        .trend-tag { 
            padding: 2px 8px; border-radius: 12px; 
            font-size: 0.7rem; font-weight: 700; 
            display: inline-block; min-width: 40px; text-align: center;
        }
        .trend-bull { background: rgba(63, 185, 80, 0.15); color: var(--up); border: 1px solid rgba(63, 185, 80, 0.3); }
        .trend-bear { background: rgba(248, 81, 73, 0.15); color: var(--down); border: 1px solid rgba(248, 81, 73, 0.3); }
        .trend-flat { background: rgba(110, 118, 129, 0.15); color: var(--flat); border: 1px solid rgba(110, 118, 129, 0.3); }

        /* RSI Bar */
        .rsi-val { font-weight: 700; font-family: monospace; font-size: 0.8rem; width: 24px; display: inline-block; text-align: right; margin-left: 6px; }
        .rsi-wrapper { display: flex; align-items: center; justify-content: flex-end; }
        .rsi-track { width: 40px; height: 4px; background: #21262d; border-radius: 2px; overflow: hidden; }
        .rsi-fill { height: 100%; border-radius: 2px; }

        /* æ–°èåˆ—è¡¨ */
        .news-box { height: 420px; overflow-y: auto; }
        .news-item { 
            padding: 12px 16px; 
            border-bottom: 1px solid var(--border-color); 
            transition: background 0.2s; 
        }
        .news-item:last-child { border-bottom: none; }
        .news-item:hover { background: rgba(56, 139, 253, 0.05); } /* æ»‘éæœ‰å¾®è—å…‰ */
        
        .news-meta { 
            display: flex; justify-content: space-between; 
            font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px; 
        }
        .news-source { 
            color: var(--accent); font-weight: 700; 
            background: rgba(88, 166, 255, 0.1); 
            padding: 1px 6px; border-radius: 4px;
        }
        .news-title a { 
            color: #e6edf3; font-weight: 500; font-size: 0.9rem; line-height: 1.4; display: block;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #58a6ff; }

        /* éŸ¿æ‡‰å¼ï¼šæ‰‹æ©Ÿè®Šå–®æ¬„ï¼Œå¹³æ¿è®Šå…©æ¬„ */
        @media (max-width: 1200px) { .main-container { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 768px) { 
            .main-container { grid-template-columns: 1fr; } 
            .header { flex-direction: column; align-items: flex-start; gap: 15px; }
            .header-actions { width: 100%; justify-content: space-between; }
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="header-title">
            <h1>ğŸš€ God Mode Terminal</h1>
            <div id="update-time" class="timestamp">System Initializing...</div>
        </div>
        
        <div class="header-actions">
            <span id="status-msg"></span>

            <div class="fng-card">
                <div class="fng-label">Crypto Sentiment</div>
                <div class="fng-value" id="fng-val">--</div>
            </div>

            <button id="refresh-btn" class="btn-refresh" onclick="triggerUpdate()">
                ğŸ”„ Update
            </button>
        </div>
    </div>

    <div class="main-container">
        
        <div>
            <div class="box">
                <div class="box-header">ğŸŒ ä¸»è¦æŒ‡æ•¸ (Global Indices)</div>
                <table>
                    <thead><tr><th>Asset</th><th>Price</th><th>Trend</th><th style="text-align:right">RSI</th></tr></thead>
                    <tbody id="indices-box"></tbody>
                </table>
            </div>
            <div class="box">
                <div class="box-header">ğŸª™ åŠ å¯†è²¨å¹£ (Crypto Assets)</div>
                <table>
                    <thead><tr><th>Asset</th><th>Price</th><th>Trend</th><th style="text-align:right">RSI</th></tr></thead>
                    <tbody id="crypto-box"></tbody>
                </table>
            </div>
        </div>

        <div>
            <div class="box">
                <div class="box-header">ğŸ”® ç¾è‚¡æœŸè²¨ (Futures)</div>
                <table>
                    <thead><tr><th>Contract</th><th>Price</th><th>Trend</th><th style="text-align:right">RSI</th></tr></thead>
                    <tbody id="futures-box"></tbody>
                </table>
            </div>
            <div class="box">
                <div class="box-header">ğŸš¢ èˆªé‹é‹åƒ¹ (Freight)</div>
                <table>
                    <thead><tr><th>Index/ETF</th><th>Price</th><th>Trend</th><th style="text-align:right">RSI</th></tr></thead>
                    <tbody id="shipping-box"></tbody>
                </table>
            </div>
            <div class="box">
                <div class="box-header">ğŸŒŠ å®è§€ & å¤–åŒ¯ (Macro/FX)</div>
                <table>
                    <thead><tr><th>Indicator</th><th>Value</th><th>Trend</th><th style="text-align:right">State</th></tr></thead>
                    <tbody id="macro-box"></tbody>
                </table>
            </div>
            <div class="box">
                <div class="box-header">ğŸ­ æ¿å¡Šè³‡é‡‘ (Sectors)</div>
                <table>
                    <thead><tr><th>Sector</th><th>Price</th><th>Trend</th><th style="text-align:right">RSI</th></tr></thead>
                    <tbody id="mixed-box"></tbody>
                </table>
            </div>
        </div>

        <div>
            <div class="box">
                <div class="box-header">âš¡ å¸‚å ´å¿«è¨Š (Live News)</div>
                <div id="news-box" class="news-box"></div>
            </div>

            <div class="box calendar-container">
                <div class="box-header">ğŸ“… è²¡ç¶“æ—¥æ›† (Calendar)</div>
                <div class="tradingview-widget-container">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
                    {
                    "width": "100%",
                    "height": "360",
                    "colorTheme": "dark",
                    "isTransparent": true,
                    "locale": "en",
                    "importanceFilter": "0,1",
                    "currencyFilter": "USD"
                    }
                    </script>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Cloudflare Trigger
        function triggerUpdate() {
            const btn = document.getElementById('refresh-btn');
            const msg = document.getElementById('status-msg');
            btn.disabled = true;
            btn.innerHTML = "â³ Sending...";
            
            // è¨˜å¾—æ›æˆä½ çš„ URL
            fetch('https://dashboard.mansantamm.workers.dev', { method: 'POST' })
                .then(r => {
                    if (r.ok) {
                        btn.innerHTML = "âœ… Sent";
                        msg.innerHTML = "Command sent. Please wait ~1m.";
                        setTimeout(() => { btn.disabled = false; btn.innerHTML = "ğŸ”„ Update"; msg.innerHTML = ""; }, 5000);
                    } else throw new Error();
                })
                .catch(e => {
                    btn.innerHTML = "âŒ Error";
                    btn.style.backgroundColor = "var(--down)";
                    msg.innerHTML = "Failed. Check Console.";
                    console.error(e);
                });
        }

        // Render Data
        fetch('daily_news.json?t=' + new Date().getTime())
            .then(r => r.json())
            .then(data => {
                document.getElementById('update-time').textContent = "LAST UPDATE: " + data.update_time;

                // Crypto Sentiment
                if(data.crypto_fng) {
                    const el = document.getElementById('fng-val');
                    const val = data.crypto_fng.value;
                    el.textContent = val;
                    el.style.color = val < 30 ? 'var(--down)' : (val > 70 ? 'var(--up)' : 'var(--text-main)');
                }

                // Table Render
                function renderTable(id, list) {
                    const el = document.getElementById(id);
                    if(!list) return;
                    list.forEach(item => {
                        const colorClass = item.change >= 0 ? 'up' : 'down';
                        const sign = item.change >= 0 ? '+' : '';
                        
                        // Trend
                        let trendHtml = '<span class="trend-tag trend-flat">RANGE</span>';
                        if(item.trend && item.trend.includes("å¤šé ­")) trendHtml = '<span class="trend-tag trend-bull">BULL</span>';
                        if(item.trend && item.trend.includes("ç©ºé ­")) trendHtml = '<span class="trend-tag trend-bear">BEAR</span>';
                        if(item.trend === "-") trendHtml = '<span style="color:#555">-</span>';

                        // RSI
                        let rsiHtml = '<td style="text-align:right; color:#555">-</td>';
                        if(item.rsi && item.rsi !== "-") {
                            let barColor = 'var(--text-muted)';
                            let valColor = 'var(--text-muted)';
                            
                            // é¡è‰²é‚è¼¯ï¼šRSI < 30 (ç¶ è‰²æ©Ÿæœƒ), RSI > 70 (ç´…è‰²å±éšª)
                            if(item.rsi > 70) { barColor = 'var(--down)'; valColor = 'var(--down)'; }
                            if(item.rsi < 30) { barColor = 'var(--up)'; valColor = 'var(--up)'; }
                            
                            rsiHtml = `
                                <td style="text-align:right;">
                                    <div class="rsi-wrapper">
                                        <div class="rsi-track"><div class="rsi-fill" style="width:${item.rsi}%; background:${barColor}"></div></div>
                                        <span class="rsi-val" style="color:${valColor}">${Math.round(item.rsi)}</span>
                                    </div>
                                </td>
                            `;
                        }

                        el.innerHTML += `
                            <tr>
                                <td><span class="asset-name">${item.name.split(' ')[1] || item.name}</span></td>
                                <td>
                                    <div class="price">${item.price.toLocaleString()}</div>
                                    <div style="font-size:0.75rem; margin-top:2px;" class="${colorClass}">${sign}${item.percent}%</div>
                                </td>
                                <td>${trendHtml}</td>
                                ${rsiHtml}
                            </tr>
                        `;
                    });
                }

                if(data.data) {
                    renderTable('indices-box', data.data.indices);
                    renderTable('crypto-box', data.data.crypto);
                    renderTable('shipping-box', data.data.shipping);
                    renderTable('futures-box', data.data.futures);
                    renderTable('macro-box', data.data.macro);
                    
                    // åˆä½µ Sectors å’Œ Commodities
                    const mixed = [...(data.data.commodities||[]), ...(data.data.sectors||[])];
                    renderTable('mixed-box', mixed);
                }

                // News
                const newsEl = document.getElementById('news-box');
                if(data.news) {
                    data.news.forEach(n => {
                        newsEl.innerHTML += `
                            <div class="news-item">
                                <div class="news-meta">
                                    <span class="news-source">${n.source}</span>
                                    <span>${n.time}</span>
                                </div>
                                <div class="news-title"><a href="${n.link}" target="_blank">${n.title}</a></div>
                            </div>
                        `;
                    });
                }
            });
    </script>
</body>
</html>
